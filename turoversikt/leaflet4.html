

<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Leaflet test</title>

    <link rel="stylesheet" type="text/css" href="https://unpkg.com/leaflet@1.0.3/dist/leaflet.css" />
    <link rel="stylesheet" type="text/css" href="https://unpkg.com/leaflet.markercluster@1.0.6/dist/MarkerCluster.css" />
    <link href='https://api.mapbox.com/mapbox.js/plugins/leaflet-fullscreen/v1.0.1/leaflet.fullscreen.css' rel='stylesheet' />
    <link rel="stylesheet" type="text/css" href="test.css" />

</head>

<body class="kindergarden-find-page">

    <div class="container">
        <header>
            <h1>Leaflet test</h1>
            <nav>
                <ul>
                    <li>
                        <a href="leaflet.html">Linjer, alle vist</a>
                    </li>
                    <li>
                        <a href="leaflet2.html">Fylt område</a>
                    </li>
                    <li class="active">
                        <a href="leaflet3.html">Markør, linje ved hover</a>
                    </li>
                </ul>
            </nav>
            <p>Kommentar fra Thomas: Kan fungere ganske godt med bedre ikoner og "tooltip". Kanskje til og med fargekode turer? Mulig også vise fylt område i stedet for linjer.</p></o>
        </header>

        <div id="leaflet-map" class="map"></div>
    </div>

    <script type="text/javascript" src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
    <script type="text/javascript" src="https://unpkg.com/leaflet@1.0.3/dist/leaflet.js"></script>
    <script type="text/javascript" src="https://unpkg.com/leaflet.markercluster@1.0.6/dist/leaflet.markercluster.js"></script>
    <script type="text/javascript" src="https://api.mapbox.com/mapbox.js/plugins/leaflet-fullscreen/v1.0.1/Leaflet.fullscreen.min.js"></script>
    <script type="text/javascript" src="https://tsadm.webatlas.no/sh/leafletplugins/L.TileLayer.Webatlas/v1.0.0/L.TileLayer.Webatlas.min.js"></script>
    <script type="text/javascript" src="https://code.jquery.com/jquery-1.12.4.min.js"></script>

    <script>

        var map;
        var bounds = new L.latLngBounds();
        var coordsArray = [];
        var routeLayers = [];
        var markers = L.markerClusterGroup();
        var tripLayers = [];

        var tripIcon = L.icon({
            iconUrl: 'icon1.png',
            iconSize:     [28, 28],
            iconAnchor:   [14, 14],
            popupAnchor:  [0, 200],
            toolTipAnchor: [28, 28]
        });
        var tripIconHover = L.icon({
            iconUrl: 'icon2.png',
            iconSize:     [28, 28],
            iconAnchor:   [14, 14],
            popupAnchor:  [0, 200],
            toolTipAnchor: [28, 28]
        });

        var getCentroid2 = function (arr) {
            var twoTimesSignedArea = 0;
            var cxTimes6SignedArea = 0;
            var cyTimes6SignedArea = 0;

            var length = arr.length

            var x = function (i) { return arr[i % length][0] };
            var y = function (i) { return arr[i % length][1] };

            for ( var i = 0; i < arr.length; i++) {
                var twoSA = x(i)*y(i+1) - x(i+1)*y(i);
                twoTimesSignedArea += twoSA;
                cxTimes6SignedArea += (x(i) + x(i+1)) * twoSA;
                cyTimes6SignedArea += (y(i) + y(i+1)) * twoSA;
            }
            var sixSignedArea = 3 * twoTimesSignedArea;
            return [  cyTimes6SignedArea/ sixSignedArea, cxTimes6SignedArea  / sixSignedArea];        
        }

        function initializeMap(container, latitude, longitude, zoom) {
            // Create a map
            var map = L.map(
                container,
                { 
                    dragging: !L.Browser.mobile,
                    tap: !L.Browser.mobile,
                    fullscreenControl: true
                }
            ).setView([latitude, longitude], zoom);

            // Peanuts demo API key from Arild Nomeland
            var apiKey = '07C4A129-9D26-4B3D-9BC8-B22E4B6E509E';

            var baseLayers = {
                'Kart': L.tileLayer.webatlas({
                    mapType: L.TileLayer.Webatlas.Type.VECTOR,
                    apikey: apiKey
                }).addTo(map),
                'Foto': L.tileLayer.webatlas({
                    mapType: L.TileLayer.Webatlas.Type.AERIAL,
                    apikey: apiKey
                }),
                'Hybrid': L.tileLayer.webatlas({
                    mapType: L.TileLayer.Webatlas.Type.HYBRID,
                    apikey: apiKey
                })
            };
            L.control.layers(baseLayers).addTo(map);
            return map;
        }
        function cropMap() {
            map.fitBounds(bounds);
        }
        function addRoute(map, no) {

            $.getJSON( "trips/" + no + ".json", function( data ) {
                var layer = L.geoJSON(data,
                {
                    style:
                    {
                        weight: 3, 
                        color: "#005692", 
                        opacity: 0
                    }
                }).addTo(map);
                layer.visible = false;
                bounds.extend(layer.getBounds())
                tripLayers.push(layer);

                var marker = new L.marker(layer.getBounds().getCenter(), {icon: tripIcon});
                marker.bindTooltip("Hverdagstur #" + no, 
                {
                    permanent: false, 
                    direction: 'right'
                });
                marker.on('mouseover', function (e) {
                    this.setIcon(tripIconHover);
                });
                marker.on('mouseout', function (e) {
                    this.setIcon(tripIcon);
                });
                marker.on('click', function (e) {
                    if (layer.visible == false) {

                        // Hide all other layers
                        $.each(tripLayers, function(index, item) {
                            if (item.visible == true) {
                                item.setStyle({opacity : 0});
                                item.visible = false;
                            }
                        })

                        layer.setStyle({opacity : 1});
                        layer.visible = true;
                    } else {
                        layer.setStyle({opacity : 0});
                        layer.visible = false;
                    }
                });
                markers.addLayer(marker);
            });
        }

        map = initializeMap("leaflet-map", 58.94, 5.74, 10);

        for (i = 0; i < 52; i++) { 
            addRoute(map, i+1);
        }

        map.addLayer(markers);

        setTimeout(function() {cropMap()}, 1000);
        map.on('fullscreenchange', function () {
            setTimeout(function() {cropMap()}, 100);
        });

    </script>

</body>
</html>